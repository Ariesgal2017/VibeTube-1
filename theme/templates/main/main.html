{% load static %}
{% include 'base.html' %}
<div x-data="{mode: 'fyp'}" class="absolute flex">
        <!-- Only two panels needed for home page. -->
        <div id="side-panel" class="fixed justify-self-start top-16 left-96">
            <span @click="mode = 'fyp'" class="cursor-pointer" :class="{'text-red-500 font-semibold': mode == 'fyp'}">
                <svg x-show="mode == 'fyp'" xmlns="http://www.w3.org/2000/svg" class="inline h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                  </svg>
                <svg x-show="mode !== 'fyp'" xmlns="http://www.w3.org/2000/svg" class="inline h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <h3 class="relative inline text-3xl top-2">For You</h3>
            </span>
            <br>
            <span @click="mode = 'following'" class="cursor-pointer" :class="{'text-red-500 font-semibold': mode == 'following'}">
                  <svg x-show="mode !== 'following'" xmlns="http://www.w3.org/2000/svg" class="inline h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                  <svg x-show="mode == 'following'" xmlns="http://www.w3.org/2000/svg" class="inline h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                  </svg>
                <h3 class="relative inline text-3xl top-2">Following</h3>
            </span>
            {% if not user.is_authenticated %}
                <div>
                    <br><br><br>
                    <h6 class="w-64 text-gray-400">Log in to follow creators, like videos, and view comments.</h6><br>
                    <button id="login-main" style="border-color: #fc2a5e; color: #fc2a5e" @click="console.log('fuck'), showLogin = ! showLogin" class="hover:bg-gray-100 border-2 h-12 font-semibold bg-opacity-0 w-56 focus:outline-none rounded-md">Log in</button>
                </div>
            {% endif %}
            <div id="suggested-accounts" class="mt-6">
                <hr><br>
                <p class="font-thin pb-4">Suggested accounts</p>
                {% for account in suggested %}
                    <div class="cursor-pointer hover:bg-gray-100">
                        <img
                            class="inline rounded-full duration-500 delay-1000 w-12 h-12 cursor-pointer"
                            alt="{{account.display_name}}'s photo"
                            src="{% if account.profile_photo %} {{account.profile_photo.url}} {% else %} {% static 'images/default.png' %} {% endif %}">
                            <span class="flex-col inline-flex -mt-2 ml-2  relative">
                                <p class="inline-flex font-semibold">
                                    {{ account.username }}
                                    {% if account.verified %}
                                    <svg class="mt-2 ml-2" width="12" height="12" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="24" fill="#20D5EC"></circle><path fill-rule="evenodd" clip-rule="evenodd" d="M37.1213 15.8787C38.2929 17.0503 38.2929 18.9497 37.1213 20.1213L23.6213 33.6213C22.4497 34.7929 20.5503 34.7929 19.3787 33.6213L10.8787 25.1213C9.70711 23.9497 9.70711 22.0503 10.8787 20.8787C12.0503 19.7071 13.9497 19.7071 15.1213 20.8787L21.5 27.2574L32.8787 15.8787C34.0503 14.7071 35.9497 14.7071 37.1213 15.8787Z" fill="white"></path></svg>
                                    {% endif %}
                                </p> 
                                
                                <p class="-mt-1">{{ account.display_name }}</p> 
                            </span>
                    </div>   
                {% endfor %}
                <div class="w-72 mt-10 text-xs text-gray-400 font-semibold cursor-pointer">
                    <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">About Newsroom Store Contact Careers Creator Directory<br>
                        Help Safety Terms Privacy Creator Portal Community Guidelines Copyright<br>
                        VibeTube for Good Advertise Developers Transparency</a><br>
                </div>
            </div>
        </div>
        <div id="videos">
            {% for video in videos %}
                <div style="left: 50rem; margin-left: 50rem;" class="mt-16">
                    <div>
                        <img
                            class="inline rounded-full duration-500 delay-1000 w-12 h-12"
                            alt="{{video.creator.display_name}}'s photo"
                            src="{% if video.creator.profile_photo %} {{video.creator.profile_photo.url}} {% else %} {% static 'images/default.png' %} {% endif %}">
                            <span class="flex-col inline-flex -mt-2 ml-2 relative">
                                <p class="inline-flex font-semibold cursor-pointer">
                                    {{ video.creator.username }}
                                    {% if video.creator.verified %}
                                    <svg class="mt-2 ml-2" width="12" height="12" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="24" r="24" fill="#20D5EC"></circle><path fill-rule="evenodd" clip-rule="evenodd" d="M37.1213 15.8787C38.2929 17.0503 38.2929 18.9497 37.1213 20.1213L23.6213 33.6213C22.4497 34.7929 20.5503 34.7929 19.3787 33.6213L10.8787 25.1213C9.70711 23.9497 9.70711 22.0503 10.8787 20.8787C12.0503 19.7071 13.9497 19.7071 15.1213 20.8787L21.5 27.2574L32.8787 15.8787C34.0503 14.7071 35.9497 14.7071 37.1213 15.8787Z" fill="white"></path></svg>
                                    {% endif %}
                                    <span class="ml-2 font-normal">{{ video.creator.display_name }}</span>
                                </p> 
                                <p>
                                    {{ video.caption }}
                                </p>
                            </span>
                    </div>   
                    <div class="flex-row flex-nowrap">
                        <video
                        class="video-js vjs-theme-forest w-72 h-96"
                        controls
                        preload="auto"
                        poster="//vjs.zencdn.net/v/oceans.png"
                        data-setup='{}'>
                            <source src="//vjs.zencdn.net/v/oceans.mp4" type="video/mp4"></source>
                        </video>
                        <div x-data="{isLiked{{video.id}} : false, triggerComment{{video.id}} : false}" id="video-interactions" class="float-right mr-2 -mt-28">
                            <span id="like">
                                <svg x-show="isLiked{{video.id}}" @click="unlikeVideo({{video.id}}), isLiked{{video.id}} = ! isLiked{{video.id}}" xmlns="http://www.w3.org/2000/svg" class="rounded-full p-2 bg-gray-200 hover:bg-gray-300 cursor-pointer h-12 w-12" fill="red" viewBox="0 0 24 24" stroke="none">
                                    <path stroke-linecap="none" stroke-linejoin="none" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                                <svg x-show="! isLiked{{video.id}}" @click="likeVideo({{video.id}}, {{video.creator.id}}, {{request.user.id}}), isLiked{{video.id}} = ! isLiked{{video.id}}" xmlns="http://www.w3.org/2000/svg" class="rounded-full p-2 bg-gray-200 hover:bg-gray-300 cursor-pointer h-12 w-12" fill="currentColor" viewBox="0 0 24 24" stroke="none">
                                    <path stroke-linecap="none" stroke-linejoin="none" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg><span id="likes-counter-{{video.id}}" class="ml-5 font-semibold text-gray-500">{{video.likes}}</span>
                            </span>
                            <span id="comment">
                                <svg x-show="! triggerComment{{video.id}}" @click="triggerComment{{video.id}} = ! triggerComment{{video.id}}" xmlns="http://www.w3.org/2000/svg" class="rounded-full p-2 bg-gray-200 hover:bg-gray-300 cursor-pointer h-12 w-12" fill="currentColor" viewBox="0 0 24 24" stroke="none">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                </svg>
                                <svg x-show="triggerComment{{video.id}}" @click="triggerComment{{video.id}} = ! triggerComment{{video.id}}" xmlns="http://www.w3.org/2000/svg" class="rounded-full p-2 bg-gray-200 hover:bg-gray-300 cursor-pointer h-12 w-12" fill="white" viewBox="0 0 24 24" stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-3.0.0.min.js"></script>
    <script>
        $(document).ready(() => {
            url = "http://localhost:8000/api-vibes"
            let videos = $('video').not("[autoplay='autoplay']");

            let checkVideos = () => {
                let scrollTop = $(window).scrollTop();
                let scrollBottom = scrollTop + $(window).height();
                
                let videosInView = []

                videos.each((ind, el) => {
                    let yTop = $(this).offset().top;
                    let yBot = $(this).height() + yTop;
                    if (yBot <= scrollBottom && yTop >= scrollTop) {
                        el.muted = true;
                        el.play();
                    } else {
                        console.log("Test Tha Shit")
                        el.pause();
                    }
                });
            }
            window.addEventListener("scroll", checkVideos)
        })


        const likeVideo = (vId, cId, viberId) => {
            postLike = fetch(`${url}/videos/${vId}/like_video/`, {
                method: "POST",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    "creator_id": cId,
                    "viber_id": viberId
                })
            }).then(resp => resp.json()).then(data => document.getElementById(`likes-counter-${vId}`).innerHTML = data.likes)
        }

        const unlikeVideo = (vId) => {
            postLike = fetch(`${url}/videos/${vId}/unlike_video/`, {
                method: "POST"
            }).then(resp => resp.json()).then(data => document.getElementById(`likes-counter-${vId}`).innerHTML = data.likes)
        }
    </script>